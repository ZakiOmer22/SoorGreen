<%@ Page Title="Pickup Status" Language="C#" MasterPageFile="~/Pages/Citizen/Site.Master" 
    AutoEventWireup="true" CodeFile="PickupStatus.aspx.cs" Inherits="SoorGreen.Admin.PickupStatus" %>


<asp:Content ID="Content3" ContentPlaceHolderID="HeadContent" runat="server">
    <link href='<%= ResolveUrl("~/Content/Pages/Citizen/citizenpickupstatus.css") %>' rel="stylesheet" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
</asp:Content>

<asp:Content ID="Content4" ContentPlaceHolderID="ScriptsContent" runat="server">
    <script src='<%= ResolveUrl("~/Scripts/Pages/Citizen/citizenpickupstatus.js") %>'></script>
    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
</asp:Content>

<asp:Content ID="Content1" ContentPlaceHolderID="TitleContent" runat="server">
    Pickup Status - SoorGreen Citizen
</asp:Content>

<asp:Content ID="Content2" ContentPlaceHolderID="MainContent" runat="server">
    <!-- Hidden Fields -->
    <asp:HiddenField ID="hfActivePickups" runat="server" ClientIDMode="Static" />
    <asp:HiddenField ID="hfPickupHistory" runat="server" ClientIDMode="Static" />
    <asp:HiddenField ID="hfStatsData" runat="server" ClientIDMode="Static" />
    <asp:HiddenField ID="hfUserId" runat="server" ClientIDMode="Static" />
    
    <div class="pickups-container">
        <!-- Header -->
        <div class="page-header-wrapper">
            <nav class="breadcrumb">
                <a href="Dashboard.aspx"><i class="fas fa-home"></i> Dashboard</a>
                <i class="fas fa-chevron-right"></i>
                <span class="active">Pickup Status</span>
            </nav>
            
            <div class="header-main">
                <div class="header-text">
                    <h1 class="page-title">
                        <i class="fas fa-truck-loading"></i>
                        Pickup Status
                    </h1>
                    <p class="page-subtitle">Track, manage, and monitor your waste collection requests</p>
                </div>
                
                <div class="header-action">
                    <button id="btnRefresh" class="btn-refresh" onclick="refreshData(); return false;">
                        <i class="fas fa-sync-alt"></i> Refresh
                    </button>
                    <button class="btn-export" onclick="exportPickups(); return false;">
                        <i class="fas fa-file-export"></i>
                        Export Data
                    </button>
                    <button class="btn-new-pickup" onclick="window.location.href='SchedulePickup.aspx'; return false;">
                        <i class="fas fa-plus"></i>
                        Schedule Pickup
                    </button>
                </div>
            </div>
            
            <!-- Stats Grid -->
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-icon">
                        <i class="fas fa-truck-loading"></i>
                    </div>
                    <div class="stat-content">
                        <div class="stat-value" id="totalPickups">0</div>
                        <div class="stat-label">Total Pickups</div>
                    </div>
                </div>
                
                <div class="stat-card">
                    <div class="stat-icon">
                        <i class="fas fa-spinner"></i>
                    </div>
                    <div class="stat-content">
                        <div class="stat-value" id="activePickups">0</div>
                        <div class="stat-label">Active</div>
                    </div>
                </div>
                
                <div class="stat-card">
                    <div class="stat-icon">
                        <i class="fas fa-check-circle"></i>
                    </div>
                    <div class="stat-content">
                        <div class="stat-value" id="completedPickups">0</div>
                        <div class="stat-label">Completed</div>
                    </div>
                </div>
                
                <div class="stat-card">
                    <div class="stat-icon">
                        <i class="fas fa-chart-line"></i>
                    </div>
                    <div class="stat-content">
                        <div class="stat-value" id="successRate">0%</div>
                        <div class="stat-label">Success Rate</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Tabs Navigation -->
        <div class="tabs-container">
            <div class="tabs">
                <button class="tab active" data-tab="active" onclick="switchTab('active'); return false;">
                    <i class="fas fa-spinner"></i>
                    Active Pickups
                    <span class="tab-badge" id="activeTabBadge">0</span>
                </button>
                <button class="tab" data-tab="history" onclick="switchTab('history'); return false;">
                    <i class="fas fa-history"></i>
                    Pickup History
                    <span class="tab-badge" id="historyTabBadge">0</span>
                </button>
            </div>
        </div>

        <!-- Filters Section -->
        <div class="filters-container">
            <div class="filters-header">
                <h3><i class="fas fa-filter"></i> Filter Pickups</h3>
                <button class="btn-clear-filters" onclick="clearFilters(); return false;">
                    <i class="fas fa-times"></i> Clear Filters
                </button>
            </div>
            
            <div class="filters-grid">
                <div class="filter-group">
                    <label><i class="fas fa-search"></i> Search</label>
                    <div class="search-box">
                        <input type="text" id="searchPickups" placeholder="Search by ID, address, or collector..." />
                        <i class="fas fa-search"></i>
                    </div>
                </div>
                
                <div class="filter-group">
                    <label><i class="fas fa-tag"></i> Status</label>
                    <select id="statusFilter" class="form-control">
                        <option value="all">All Status</option>
                        <option value="Requested">Requested</option>
                        <option value="Scheduled">Scheduled</option>
                        <option value="Assigned">Assigned</option>
                        <option value="In Progress">In Progress</option>
                        <option value="Completed">Completed</option>
                        <option value="Cancelled">Cancelled</option>
                    </select>
                </div>
                
                <div class="filter-group">
                    <label><i class="fas fa-trash-alt"></i> Waste Type</label>
                    <select id="wasteTypeFilter" class="form-control">
                        <option value="all">All Types</option>
                        <option value="Plastic">Plastic</option>
                        <option value="Paper">Paper</option>
                        <option value="Glass">Glass</option>
                        <option value="Metal">Metal</option>
                        <option value="E-Waste">E-Waste</option>
                        <option value="Organic">Organic</option>
                    </select>
                </div>
                
                <div class="filter-group">
                    <label><i class="fas fa-calendar"></i> Date Range</label>
                    <div class="date-range-picker">
                        <input type="text" id="dateRangeFilter" placeholder="Select date range..." readonly />
                        <i class="fas fa-calendar-alt"></i>
                    </div>
                </div>
            </div>
            
            <div class="filters-actions">
                <button class="btn-apply-filters" onclick="applyFilters(); return false;">
                    <i class="fas fa-check"></i> Apply Filters
                </button>
            </div>
        </div>

        <!-- Active Pickups Tab Content -->
        <div class="tab-content active" id="activeTabContent">
            <div class="reports-section">
                <div class="section-header">
                    <h2><i class="fas fa-spinner"></i> Active Pickups</h2>
                    <div class="section-actions">
                        <div class="view-toggle">
                            <button class="view-btn active" data-view="grid" onclick="switchView('grid'); return false;">
                                <i class="fas fa-th-large"></i>
                            </button>
                            <button class="view-btn" data-view="list" onclick="switchView('list'); return false;">
                                <i class="fas fa-list"></i>
                            </button>
                        </div>
                        <select id="sortBy" class="form-control" onchange="sortPickups(); return false;">
                            <option value="date-newest">Date: Newest First</option>
                            <option value="date-oldest">Date: Oldest First</option>
                            <option value="weight-high">Weight: High to Low</option>
                            <option value="status">Status</option>
                        </select>
                    </div>
                </div>
                
                <!-- Grid View -->
                <div class="reports-grid" id="activeGridView">
                    <div class="loading-state">
                        <i class="fas fa-spinner fa-spin"></i>
                        <p>Loading active pickups...</p>
                    </div>
                </div>
                
                <!-- List View -->
                <div class="reports-table-container" id="activeListView" style="display: none;">
                    <table class="reports-table">
                        <thead>
                            <tr>
                                <th>Pickup ID</th>
                                <th>Waste Type</th>
                                <th>Weight</th>
                                <th>Address</th>
                                <th>Scheduled Date</th>
                                <th>Collector</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="activeTableBody">
                            <tr>
                                <td colspan="8" class="text-center">Loading active pickups...</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                
                <!-- Empty State -->
                <div id="activeEmptyState" class="empty-state" style="display: none;">
                    <div class="empty-state-icon">
                        <i class="fas fa-calendar-check"></i>
                    </div>
                    <h3>No Active Pickups</h3>
                    <p>You don't have any active pickups at the moment.</p>
                    <button class="btn btn-primary" onclick="window.location.href='SchedulePickup.aspx'; return false;">
                        <i class="fas fa-plus"></i> Schedule a Pickup
                    </button>
                </div>
                
                <!-- Pagination -->
                <div class="pagination-container">
                    <div class="pagination-info" id="activePaginationInfo">Showing 0 pickups</div>
                    <div class="pagination-controls">
                        <button class="btn-pagination" id="activePrevPageBtn" onclick="prevPage('active'); return false;" disabled>
                            <i class="fas fa-chevron-left"></i> Previous
                        </button>
                        <div class="page-numbers" id="activePageNumbers"></div>
                        <button class="btn-pagination" id="activeNextPageBtn" onclick="nextPage('active'); return false;" disabled>
                            Next <i class="fas fa-chevron-right"></i>
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- History Tab Content -->
        <div class="tab-content" id="historyTabContent" style="display: none;">
            <div class="reports-section">
                <div class="section-header">
                    <h2><i class="fas fa-history"></i> Pickup History</h2>
                    <div class="section-actions">
                        <div class="view-toggle">
                            <button class="view-btn active" data-view="grid" onclick="switchHistoryView('grid'); return false;">
                                <i class="fas fa-th-large"></i>
                            </button>
                            <button class="view-btn" data-view="list" onclick="switchHistoryView('list'); return false;">
                                <i class="fas fa-list"></i>
                            </button>
                        </div>
                        <select id="historySortBy" class="form-control" onchange="sortHistory(); return false;">
                            <option value="date-newest">Date: Newest First</option>
                            <option value="date-oldest">Date: Oldest First</option>
                            <option value="xp-high">XP: High to Low</option>
                            <option value="weight-high">Weight: High to Low</option>
                        </select>
                    </div>
                </div>
                
                <!-- Grid View -->
                <div class="reports-grid" id="historyGridView">
                    <div class="loading-state">
                        <i class="fas fa-spinner fa-spin"></i>
                        <p>Loading pickup history...</p>
                    </div>
                </div>
                
                <!-- List View -->
                <div class="reports-table-container" id="historyListView" style="display: none;">
                    <table class="reports-table">
                        <thead>
                            <tr>
                                <th>Pickup ID</th>
                                <th>Waste Type</th>
                                <th>Weight</th>
                                <th>Address</th>
                                <th>Completed Date</th>
                                <th>Collector</th>
                                <th>XP Earned</th>
                                <th>Status</th>
                            </tr>
                        </thead>
                        <tbody id="historyTableBody">
                            <tr>
                                <td colspan="8" class="text-center">Loading pickup history...</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                
                <!-- Empty State -->
                <div id="historyEmptyState" class="empty-state" style="display: none;">
                    <div class="empty-state-icon">
                        <i class="fas fa-history"></i>
                    </div>
                    <h3>No Pickup History</h3>
                    <p>You haven't completed any pickups yet.</p>
                </div>
                
                <!-- Pagination -->
                <div class="pagination-container">
                    <div class="pagination-info" id="historyPaginationInfo">Showing 0 pickups</div>
                    <div class="pagination-controls">
                        <button class="btn-pagination" id="historyPrevPageBtn" onclick="prevPage('history'); return false;" disabled>
                            <i class="fas fa-chevron-left"></i> Previous
                        </button>
                        <div class="page-numbers" id="historyPageNumbers"></div>
                        <button class="btn-pagination" id="historyNextPageBtn" onclick="nextPage('history'); return false;" disabled>
                            Next <i class="fas fa-chevron-right"></i>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Pickup Details Modal -->
    <div class="modal-overlay" id="pickupDetailsModal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h2><i class="fas fa-truck-loading"></i> Pickup Details</h2>
                <button class="btn-close-modal" onclick="closeModal(); return false;">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div class="modal-body">
                <div class="report-details" id="pickupDetailsContent">
                    <!-- Will be populated by JavaScript -->
                </div>
                
                <div class="modal-actions">
                    <button class="btn btn-outline" onclick="closeModal(); return false;">
                        <i class="fas fa-times"></i> Close
                    </button>
                    <button class="btn btn-warning" id="cancelPickupBtn" onclick="showCancelConfirmation(); return false;">
                        <i class="fas fa-times-circle"></i> Cancel Pickup
                    </button>
                    <button class="btn btn-primary" id="reschedulePickupBtn" onclick="reschedulePickup(); return false;">
                        <i class="fas fa-calendar-alt"></i> Reschedule
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Cancel Confirmation Modal -->
    <div class="modal-overlay" id="cancelConfirmationModal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h2><i class="fas fa-exclamation-triangle"></i> Confirm Cancellation</h2>
                <button class="btn-close-modal" onclick="closeCancelModal(); return false;">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div class="modal-body">
                <div class="delete-warning">
                    <i class="fas fa-times-circle"></i>
                    <h3>Cancel Pickup?</h3>
                    <p id="cancelMessage">Are you sure you want to cancel this pickup? This action cannot be undone.</p>
                </div>
                
                <div class="modal-actions">
                    <button class="btn btn-outline" onclick="closeCancelModal(); return false;">
                        <i class="fas fa-times"></i> Cancel
                    </button>
                    <button class="btn btn-danger" id="confirmCancelBtn" onclick="cancelPickup(); return false;">
                        <i class="fas fa-times-circle"></i> Cancel Pickup
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Export Modal -->
    <div class="modal-overlay" id="exportModal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h2><i class="fas fa-file-export"></i> Export Pickups</h2>
                <button class="btn-close-modal" onclick="closeExportModal(); return false;">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div class="modal-body">
                <div class="export-options">
                    <div class="export-option">
                        <input type="radio" id="exportPdf" name="exportFormat" value="pdf" checked />
                        <label for="exportPdf">
                            <i class="fas fa-file-pdf"></i>
                            <div>
                                <h4>PDF Document</h4>
                                <p>Best for printing and sharing</p>
                            </div>
                        </label>
                    </div>
                    
                    <div class="export-option">
                        <input type="radio" id="exportExcel" name="exportFormat" value="excel" />
                        <label for="exportExcel">
                            <i class="fas fa-file-excel"></i>
                            <div>
                                <h4>Excel Spreadsheet</h4>
                                <p>Best for data analysis</p>
                            </div>
                        </label>
                    </div>
                    
                    <div class="export-option">
                        <input type="radio" id="exportCsv" name="exportFormat" value="csv" />
                        <label for="exportCsv">
                            <i class="fas fa-file-csv"></i>
                            <div>
                                <h4>CSV File</h4>
                                <p>Best for importing to other systems</p>
                            </div>
                        </label>
                    </div>
                </div>
                
                <div class="export-settings">
                    <div class="form-group">
                        <label><i class="fas fa-calendar"></i> Date Range</label>
                        <select id="exportDateRange" class="form-control">
                            <option value="all">All Pickups</option>
                            <option value="active">Active Only</option>
                            <option value="history">History Only</option>
                            <option value="today">Today</option>
                            <option value="week">This Week</option>
                            <option value="month">This Month</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label><i class="fas fa-columns"></i> Include Data</label>
                        <div class="checkbox-group">
                            <label class="checkbox-label">
                                <input type="checkbox" id="includeBasic" checked />
                                <span class="checkmark"></span>
                                Basic Information
                            </label>
                            <label class="checkbox-label">
                                <input type="checkbox" id="includeStatus" checked />
                                <span class="checkmark"></span>
                                Status Details
                            </label>
                            <label class="checkbox-label">
                                <input type="checkbox" id="includePerformance" />
                                <span class="checkmark"></span>
                                Performance Metrics
                            </label>
                        </div>
                    </div>
                </div>
                
                <div class="modal-actions">
                    <button class="btn btn-outline" onclick="closeExportModal(); return false;">
                        <i class="fas fa-times"></i> Cancel
                    </button>
                    <button class="btn btn-primary" onclick="generateExport(); return false;">
                        <i class="fas fa-download"></i> Export
                    </button>
                </div>
            </div>
        </div>
    </div>
</asp:Content>